#!/bin/bash

#PBS -l nodes=1:ppn=8,walltime=12:00:00
#PBS -l vmem=31gb
#PBS -N tractseg
#PBS -V

python brainlife-utils/create_training_dataset.py
singularity exec --nv docker://paoloavesani/docker-test \
                    bin/peaks_to_cnn \
                    -json brainlife-utils/brainlife_config_training.json
                    
if [ -d 'final_output/' ]; then 
  rm -r final_output
fi

mv output final_output
                 
mkdir weights
mv final_output/*.npz weights/.
mv final_output/Hyperparameters.txt weights/.

if [ -f 'weights/*.npz' ]; then 
  echo "Training completed."
else 
  echo "Weights missing."
  exit 1
fi
